#!/usr/bin/env python3

#
# Copyright (C) 2022 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import json
import sys
import agent

# Try to parse the stdin as JSON.
# If parsing fails, output everything to stderr
data = json.load(sys.stdin)

#This is specific to you module, so you need to change it accordingly.
#agent.dump_env()
POSTGRES_HOST_AUTH_METHOD = data.get("POSTGRES_HOST_AUTH_METHOD") 
POSTGRES_DB = data.get("POSTGRES_DB") 
POSTGRES_PASSWORD = data.get("POSTGRES_PASSWORD") 
 
postgres = { 
 "POSTGRES_HOST_AUTH_METHOD" : POSTGRES_HOST_AUTH_METHOD ,
 "POSTGRES_DB" : POSTGRES_DB ,
 "POSTGRES_PASSWORD" : POSTGRES_PASSWORD ,
} 
agent.write_envfile("postgres.env", postgres) 
 
redis = { 
} 
agent.write_envfile("redis.env", redis) 
 
mongo = { 
} 
agent.write_envfile("mongo.env", mongo) 
 
nginx = { 
} 
agent.write_envfile("nginx.env", nginx) 
DJANGO_SECRET_KEY = data.get("DJANGO_SECRET_KEY") 
DJANGO_DEBUG = data.get("DJANGO_DEBUG") 
PYTHONUNBUFFERED = data.get("PYTHONUNBUFFERED") 
DATABASE_URL = data.get("DATABASE_URL") 
KC_DATABASE_URL = data.get("KC_DATABASE_URL") 
REDIS_SESSION_URL = data.get("REDIS_SESSION_URL") 
ENKETO_REDIS_MAIN_URL = data.get("ENKETO_REDIS_MAIN_URL") 
CELERY_BROKER_URL = data.get("CELERY_BROKER_URL") 
CACHE_URL = data.get("CACHE_URL") 
SERVICE_ACCOUNT_BACKEND_URL = data.get("SERVICE_ACCOUNT_BACKEND_URL") 
PUBLIC_REQUEST_SCHEME = data.get("PUBLIC_REQUEST_SCHEME") 
SESSION_COOKIE_DOMAIN = data.get("SESSION_COOKIE_DOMAIN") 
KOBOCAT_INTERNAL_URL = data.get("KOBOCAT_INTERNAL_URL") 
KOBOCAT_URL = data.get("KOBOCAT_URL") 
MONGO_DB_URL = data.get("MONGO_DB_URL") 
KOBOFORM_INTERNAL_URL = data.get("KOBOFORM_INTERNAL_URL") 
KOBOFORM_URL = data.get("KOBOFORM_URL") 
ENKETO_URL = data.get("ENKETO_URL") 
ENKETO_INTERNAL_URL = data.get("ENKETO_INTERNAL_URL") 
SERVICE_ACCOUNT_WHITELISTED_HOSTS = data.get("SERVICE_ACCOUNT_WHITELISTED_HOSTS") 
EMAIL_BACKEND = data.get("EMAIL_BACKEND") 
EMAIL_HOST = data.get("EMAIL_HOST") 
EMAIL_PORT = data.get("EMAIL_PORT") 
 
kpi = { 
 "DJANGO_SECRET_KEY" : DJANGO_SECRET_KEY ,
 "DJANGO_DEBUG" : DJANGO_DEBUG ,
 "PYTHONUNBUFFERED" : PYTHONUNBUFFERED ,
 "DATABASE_URL" : DATABASE_URL ,
 "KC_DATABASE_URL" : KC_DATABASE_URL ,
 "REDIS_SESSION_URL" : REDIS_SESSION_URL ,
 "ENKETO_REDIS_MAIN_URL" : ENKETO_REDIS_MAIN_URL ,
 "CELERY_BROKER_URL" : CELERY_BROKER_URL ,
 "CACHE_URL" : CACHE_URL ,
 "SERVICE_ACCOUNT_BACKEND_URL" : SERVICE_ACCOUNT_BACKEND_URL ,
 "PUBLIC_REQUEST_SCHEME" : PUBLIC_REQUEST_SCHEME ,
 "SESSION_COOKIE_DOMAIN" : SESSION_COOKIE_DOMAIN ,
 "KOBOCAT_INTERNAL_URL" : KOBOCAT_INTERNAL_URL ,
 "KOBOCAT_URL" : KOBOCAT_URL ,
 "MONGO_DB_URL" : MONGO_DB_URL ,
 "KOBOFORM_INTERNAL_URL" : KOBOFORM_INTERNAL_URL ,
 "KOBOFORM_URL" : KOBOFORM_URL ,
 "ENKETO_URL" : ENKETO_URL ,
 "ENKETO_INTERNAL_URL" : ENKETO_INTERNAL_URL ,
 "SERVICE_ACCOUNT_WHITELISTED_HOSTS" : SERVICE_ACCOUNT_WHITELISTED_HOSTS ,
 "EMAIL_BACKEND" : EMAIL_BACKEND ,
 "EMAIL_HOST" : EMAIL_HOST ,
 "EMAIL_PORT" : EMAIL_PORT ,
} 
agent.write_envfile("kpi.env", kpi) 
DJANGO_SECRET_KEY = data.get("DJANGO_SECRET_KEY") 
DJANGO_DEBUG = data.get("DJANGO_DEBUG") 
PYTHONUNBUFFERED = data.get("PYTHONUNBUFFERED") 
DATABASE_URL = data.get("DATABASE_URL") 
KC_DATABASE_URL = data.get("KC_DATABASE_URL") 
REDIS_SESSION_URL = data.get("REDIS_SESSION_URL") 
ENKETO_REDIS_MAIN_URL = data.get("ENKETO_REDIS_MAIN_URL") 
CELERY_BROKER_URL = data.get("CELERY_BROKER_URL") 
CACHE_URL = data.get("CACHE_URL") 
SERVICE_ACCOUNT_BACKEND_URL = data.get("SERVICE_ACCOUNT_BACKEND_URL") 
PUBLIC_REQUEST_SCHEME = data.get("PUBLIC_REQUEST_SCHEME") 
SESSION_COOKIE_DOMAIN = data.get("SESSION_COOKIE_DOMAIN") 
KOBOCAT_INTERNAL_URL = data.get("KOBOCAT_INTERNAL_URL") 
KOBOCAT_URL = data.get("KOBOCAT_URL") 
MONGO_DB_URL = data.get("MONGO_DB_URL") 
KOBOFORM_INTERNAL_URL = data.get("KOBOFORM_INTERNAL_URL") 
KOBOFORM_URL = data.get("KOBOFORM_URL") 
ENKETO_URL = data.get("ENKETO_URL") 
ENKETO_INTERNAL_URL = data.get("ENKETO_INTERNAL_URL") 
SERVICE_ACCOUNT_WHITELISTED_HOSTS = data.get("SERVICE_ACCOUNT_WHITELISTED_HOSTS") 
EMAIL_BACKEND = data.get("EMAIL_BACKEND") 
EMAIL_HOST = data.get("EMAIL_HOST") 
EMAIL_PORT = data.get("EMAIL_PORT") 
 
kpi_worker = { 
 "DJANGO_SECRET_KEY" : DJANGO_SECRET_KEY ,
 "DJANGO_DEBUG" : DJANGO_DEBUG ,
 "PYTHONUNBUFFERED" : PYTHONUNBUFFERED ,
 "DATABASE_URL" : DATABASE_URL ,
 "KC_DATABASE_URL" : KC_DATABASE_URL ,
 "REDIS_SESSION_URL" : REDIS_SESSION_URL ,
 "ENKETO_REDIS_MAIN_URL" : ENKETO_REDIS_MAIN_URL ,
 "CELERY_BROKER_URL" : CELERY_BROKER_URL ,
 "CACHE_URL" : CACHE_URL ,
 "SERVICE_ACCOUNT_BACKEND_URL" : SERVICE_ACCOUNT_BACKEND_URL ,
 "PUBLIC_REQUEST_SCHEME" : PUBLIC_REQUEST_SCHEME ,
 "SESSION_COOKIE_DOMAIN" : SESSION_COOKIE_DOMAIN ,
 "KOBOCAT_INTERNAL_URL" : KOBOCAT_INTERNAL_URL ,
 "KOBOCAT_URL" : KOBOCAT_URL ,
 "MONGO_DB_URL" : MONGO_DB_URL ,
 "KOBOFORM_INTERNAL_URL" : KOBOFORM_INTERNAL_URL ,
 "KOBOFORM_URL" : KOBOFORM_URL ,
 "ENKETO_URL" : ENKETO_URL ,
 "ENKETO_INTERNAL_URL" : ENKETO_INTERNAL_URL ,
 "SERVICE_ACCOUNT_WHITELISTED_HOSTS" : SERVICE_ACCOUNT_WHITELISTED_HOSTS ,
 "EMAIL_BACKEND" : EMAIL_BACKEND ,
 "EMAIL_HOST" : EMAIL_HOST ,
 "EMAIL_PORT" : EMAIL_PORT ,
} 
agent.write_envfile("kpi_worker.env", kpi_worker) 
ENKETO_REDIS_MAIN_URL = data.get("ENKETO_REDIS_MAIN_URL") 
ENKETO_REDIS_CACHE_URL = data.get("ENKETO_REDIS_CACHE_URL") 
ENKETO_MAX_PROCESSES = data.get("ENKETO_MAX_PROCESSES") 
ENKETO_LINKED_FORM_AND_DATA_SERVER_SERVER_URL = data.get("ENKETO_LINKED_FORM_AND_DATA_SERVER_SERVER_URL") 
ENKETO_LINKED_FORM_AND_DATA_SERVER_AUTHENTICATION_ALLOW_INSECURE_TRANSPORT = data.get("ENKETO_LINKED_FORM_AND_DATA_SERVER_AUTHENTICATION_ALLOW_INSECURE_TRANSPORT") 
 
enketo_express = { 
 "ENKETO_REDIS_MAIN_URL" : ENKETO_REDIS_MAIN_URL ,
 "ENKETO_REDIS_CACHE_URL" : ENKETO_REDIS_CACHE_URL ,
 "ENKETO_MAX_PROCESSES" : ENKETO_MAX_PROCESSES ,
 "ENKETO_LINKED_FORM_AND_DATA_SERVER_SERVER_URL" : ENKETO_LINKED_FORM_AND_DATA_SERVER_SERVER_URL ,
 "ENKETO_LINKED_FORM_AND_DATA_SERVER_AUTHENTICATION_ALLOW_INSECURE_TRANSPORT" : ENKETO_LINKED_FORM_AND_DATA_SERVER_AUTHENTICATION_ALLOW_INSECURE_TRANSPORT ,
} 
agent.write_envfile("enketo_express.env", enketo_express) 
